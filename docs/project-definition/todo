# ðŸš€ DCD Fitness: 72-Hour TDD Sprint Board

**Philosophy:** _Infra â†’ Schema â†’ API â†’ UI (Public) â†’ UI (Private)._
**Status:** Approved.

---

## ðŸ—ï¸ Phase 0: Infrastructure & Provisioning

_Goal: Establish the serverless environment._
_Scope: Google Cloud Console & Local Config_

- [ ] **0.1: Firebase Project Setup**
- Create Project `dcd-fitness-mvp` in Firebase Console.
- **Auth:** Enable "Email/Password" and "Google" providers.
- **Firestore:** Create Database (Production Mode) -> Select Region (e.g., `us-central1`).

- [ ] **0.2: Local Environment**
- Copy Firebase Web Config (`apiKey`, `appId`, etc.) to `apps/web/.env.local`.
- Generate Service Account Key for Admin SDK and save to `apps/functions/.env`.

- [ ] **0.3: Security Rules Deployment**
- Copy the **Sub-collection Rules** (from Tech Doc) to `firestore.rules`.
- Run `firebase deploy --only firestore:rules`.

---

## ðŸŸ¢ Phase 1: The Iron Core (Shared & Schema)

_Goal: Define the immutable rules of the application._
_Scope: `packages/shared_`

- [ ] **1.1: Environment & Config**
- Initialize `packages/shared` with `zod` and `vitest`.

- [ ] **1.2: The Library Schema (Test & Code)**
- **Red:** Write test asserting `Exercise` must have `ownerId` (User vs System).
- **Green:** Export `ExerciseSchema` and `MuscleGroupEnum`.

- [ ] **1.3: The Log Schema (Test & Code)**
- **Red:** Write test asserting `SkillPayload` fails if `made` > `attempts`.
- **Green:** Export `ActivityLogSchema` using Zod Discriminated Unions.

- [ ] **1.4: Type Generation**
- Run `pnpm build` to generate TS types (`ActivityLog`, `Exercise`) for the monorepo.

---

## ðŸŸ¡ Phase 2: The Secure Backend (API Layer)

_Goal: Build the "Write" operations and Security._
_Scope: `apps/functions_`

- [ ] **2.1: The Seeding Script (Crucial)**
- Write a script `scripts/seed-system.ts` to push 10 default exercises (Bench, Squat, Run) to `exercises/{id}` with `ownerId: 'system'`.
- Run script to populate Firestore.

- [ ] **2.2: Context & Auth Middleware**
- Implement `createContext` to verify Firebase ID Token.
- Implement `protectedProcedure` middleware (throws `TRPCError: UNAUTHORIZED` if no user).

- [ ] **2.3: Exercise Router (The Hybrid Query)**
- **Logic:** Query Firestore `exercises` where `ownerId == 'system'` OR `ownerId == ctx.uid`.

- [ ] **2.4: Log Router (The Write Gate)**
- **Logic:** `create` mutation. Takes `ActivityLogSchema`. Writes to path `users/{ctx.uid}/logs/{autoId}`.

---

## ðŸ”µ Phase 3: The Public Frontend (UI & Landing)

_Goal: Build the Design System and the "Front Door"._
_Scope: `apps/web` & `packages/ui_`

- [ ] **3.1: Design System ("Soft Industrial")**
- Update `tailwind.config.ts` (Zinc-950/900/50).
- Build `LabCard` (Glassmorphism), `LabButton` (Primary/Ghost), `LabInput` (Underline style).

- [ ] **3.2: The Landing Page (`/`)**
- **Hero Section:** Implement the "Talent is Cheap / Discipline is Costly" Typewriter effect.
- **Features Grid:** 3 `LabCard` components (Measure, Analyze, Evolve).
- **Auth Gateway:** Create the `AuthForm` component (Login/Register tabs) that interacts with `firebase/auth`.

- [ ] **3.3: Routing & Guards**
- Setup `react-router-dom`.
- Create `ProtectedRoute` component: Redirects to `/` if `auth.currentUser` is null.

---

## ðŸŸ£ Phase 4: The Private Dashboard (Feature Loop)

_Goal: Connect the pipes. The "Hybrid" implementation._
_Scope: `apps/web_`

- [ ] **4.1: State Management**
- Create `useDateStore` (Zustand) to manage `selectedDate` string.
- Build `<DateNavigation />` component (Prev/Next Day).

- [ ] **4.2: The "Read" Pipe (Real-time)**
- Create hook `useDailyLogs(date)`.
- **Implementation:** Use Firebase SDK `onSnapshot` on `users/{uid}/logs` filtered by Date.

- [ ] **4.3: The "Write" Pipe (Validation)**
- Build `AddLogModal` using `react-hook-form`.
- Connect submission to `trpc.log.create.useMutation`.

- [ ] **4.4: The Library Interface**
- Fetch exercises via `trpc.exercise.list.useQuery`.

---

## ðŸŸ  Phase 5: Visualization & Polish

_Goal: The "Heatmap" and final UX touches._
_Scope: `apps/web_`

- [ ] **5.1: The Heatmap Logic**
- Create hook `useMonthlyStatus(year, month)`.
- **Query:** Fetch all logs for the month (via Firebase SDK).
- **Transform:** Reduce logs into a Map: `{'2023-10-01': 'strength'}`.

- [ ] **5.2: The UI Implementation**
- Implement `Shadcn Calendar`.
- Apply modifiers to color-code days based on the Map.

---
